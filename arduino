#include <SPI.h>       // MFRC522 (NFC) 라이브러리

#include <MFRC522.h>   // MFRC522 (NFC) 라이브러리



// --- 핀 번호 설정 (우노 전용) ---



// NFC 핀 (사진과 동일)

#define RST_PIN   9    // MFRC522 리셋 핀

#define SS_PIN    10   // MFRC522 SS (CS) 핀



// 초음파 센서 핀

int trig = 2;

int echo = 3;



// LED 핀 (파란색)

int bLED = 7;



// 부저 핀 (새로 추가)

int buzzerPin = 8;



// MFRC522 객체 생성

MFRC522 mfrc522(SS_PIN, RST_PIN);  



void setup() {

  // 시리얼 통신 설정 (우노는 9600)

  Serial.begin(9600);

  

  // SPI 및 MFRC522 초기화

  SPI.begin();          

  mfrc522.PCD_Init();   

  

  // 초음파 센서 핀 모드 설정

  pinMode(trig, OUTPUT);

  pinMode(echo, INPUT);

  

  // 파란색 LED 핀 모드 설정

  pinMode(bLED, OUTPUT);

  

  // 부저 핀 모드 설정

  pinMode(buzzerPin, OUTPUT);

  

  Serial.println("--- 스마트 주차 센서 (NFC + 초음파) ---");

  Serial.println("시스템 준비 완료.");

}



void loop() {

  

  // --- 1. NFC 태그 감지 로직 ---

  // 새 태그가 감지되고, 읽기에 성공하면

  if ( mfrc522.PICC_IsNewCardPresent() && mfrc522.PICC_ReadCardSerial() ) {

    

    Serial.print("NFC 태그 감지! ID: ");

    // 태그 ID 출력

    for (byte i = 0; i < mfrc522.uid.size; i++) {

       Serial.print(mfrc522.uid.uidByte[i], HEX);

    }

    Serial.println();

    

    // 부저 울리기 (0.2초)

    tone(buzzerPin, 1000, 200);

    

    // 태그가 계속 찍히는 것을 방지

    mfrc522.PICC_HaltA(); 

  }



  // --- 2. 초음파 센서 거리 측정 로직 ---

  float duration, distance;

  

  digitalWrite(trig, HIGH);

  delayMicroseconds(10);

  digitalWrite(trig, LOW);



  duration = pulseIn(echo, HIGH);

  distance = (duration * 340) / 10000.0 / 2.0; 



  Serial.print("거리 : ");

  Serial.print(distance);

  Serial.println("cm");



  // --- 3. 파란색 LED 제어 로직 (10cm 기준) ---

  if (distance < 10 && distance > 0) {

    digitalWrite(bLED, HIGH); // 10cm 미만이면 켜기

  } else {

    digitalWrite(bLED, LOW);  // 10cm 이상이면 끄기

  }

  

  // 0.1초마다 반복

  delay(100); 

}
